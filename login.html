<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CEDP SAC — Iniciar sesión</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-md p-6 bg-white rounded-2xl shadow-lg">
    <h1 class="text-2xl font-900 text-slate-900">Iniciar sesión</h1>
    <p class="text-sm text-slate-500 mt-2">Accede con tu correo y contraseña o regístrate si eres nuevo.</p>

    <div id="alert" class="hidden mt-4 p-3 rounded-lg bg-rose-50 text-rose-700"></div>

    <div id="forms" class="mt-6">
      <!-- Login form -->
      <form id="loginForm" class="space-y-4">
        <div>
          <label class="text-sm font-700 text-slate-900">Correo</label>
          <input id="loginEmail" type="email" required class="w-full mt-2 border-2 border-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600" />
        </div>
        <div>
          <label class="text-sm font-700 text-slate-900">Contraseña</label>
          <input id="loginPassword" type="password" required class="w-full mt-2 border-2 border-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600" />
        </div>
        <div class="flex justify-between items-center">
          <button type="submit" class="px-5 py-2 rounded-lg bg-indigo-600 text-white font-700">Entrar</button>
          <button type="button" id="toRegister" class="text-sm text-indigo-600">Crear cuenta</button>
        </div>
      </form>

      <!-- Register form -->
      <form id="registerForm" class="space-y-4 hidden">
        <div>
          <label class="text-sm font-700 text-slate-900">Nombre completo</label>
          <input id="regName" type="text" class="w-full mt-2 border-2 border-slate-200 rounded-lg px-4 py-2" />
        </div>
        <div>
          <label class="text-sm font-700 text-slate-900">Correo</label>
          <input id="regEmail" type="email" class="w-full mt-2 border-2 border-slate-200 rounded-lg px-4 py-2" />
        </div>
        <div>
          <label class="text-sm font-700 text-slate-900">Contraseña</label>
          <input id="regPassword" type="password" class="w-full mt-2 border-2 border-slate-200 rounded-lg px-4 py-2" />
        </div>
        <div class="flex justify-between items-center">
          <button type="submit" class="px-5 py-2 rounded-lg bg-emerald-600 text-white font-700">Crear cuenta</button>
          <button type="button" id="toLogin" class="text-sm text-indigo-600">Ya tengo cuenta</button>
        </div>
      </form>
    </div>

    <p class="text-xs text-slate-500 mt-6">Volver a <a href="index.html" class="text-indigo-600">inicio</a>.</p>
  </div>

  <script>
    // Simple localStorage-based users for demo
    function getUsers(){ return JSON.parse(localStorage.getItem('cedp_users') || '[]'); }
    function saveUsers(u){ localStorage.setItem('cedp_users', JSON.stringify(u)); }
    function saveSession(user){ localStorage.setItem('cedp_user', JSON.stringify(user)); }

    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const toRegister = document.getElementById('toRegister');
    const toLogin = document.getElementById('toLogin');
    const alertBox = document.getElementById('alert');

    function showAlert(msg, isError=true){ alertBox.textContent = msg; alertBox.classList.remove('hidden'); alertBox.classList.toggle('bg-rose-50', isError); alertBox.classList.toggle('bg-emerald-50', !isError); alertBox.classList.toggle('text-rose-700', isError); alertBox.classList.toggle('text-emerald-700', !isError); setTimeout(()=>alertBox.classList.add('hidden'), 3500); }

    toRegister.addEventListener('click', ()=>{ loginForm.classList.add('hidden'); registerForm.classList.remove('hidden'); });
    toLogin.addEventListener('click', ()=>{ registerForm.classList.add('hidden'); loginForm.classList.remove('hidden'); });

    loginForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const pwd = document.getElementById('loginPassword').value;
      const users = getUsers();
      const u = users.find(x=>x.email===email && x.password===pwd);
      if(!u){ showAlert('Usuario o contraseña incorrectos'); return; }
      const session = { name: u.name || email.split('@')[0], email: u.email, lastAccess: Date.now() };
      saveSession(session);
      // redirect to dashboard
      window.location.href = 'user.html';
    });

    registerForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = document.getElementById('regName').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const pwd = document.getElementById('regPassword').value;
      if(!email || !pwd){ showAlert('Completa email y contraseña'); return; }
      const users = getUsers();
      if(users.find(x=>x.email===email)){ showAlert('Ya existe una cuenta con ese correo'); return; }
      users.push({name, email, password: pwd});
      saveUsers(users);
      saveSession({name, email, lastAccess: Date.now()});
      // redirect to dashboard
      window.location.href = 'user.html';
    });
  </script>
</body>
</html>
